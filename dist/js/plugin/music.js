define("music",[],function(require,exports){var a=function(a,b,c){var d=function(e){a.removeEventListener(b,d,!1),c.call(this,e)};a.addEventListener(b,d,!1)},b=/i(Phone|P(o|a)d)/.test(navigator.userAgent),c=function(){var a=document.createElement("i");return a.className="icon-music",a},d=function(a,b,d,e){this.isPlay=!1,this.isReady=!1,this.autoPlay=!!d,this.audio=new Audio(a),this.audio.loop=!!b,this.audio.autoplay=!1,this.icon=c(),!!e&&document.body.appendChild(this.icon),this.timeStamp="music_current_time"+a,this.stateStamp="music_play_state"+a,this.currentTime=Number(sessionStorage[this.timeStamp])||0,this.play_state=sessionStorage[this.stateStamp],this._playEventList=[],this._stopEventList=[],this._loadEventList=[],this.init()};return d.prototype={constructor:d,_firePlayEvent:function(){var a=this;a._playEventList.forEach(function(b){b.call(a)})},_fireStopEvent:function(){var a=this;a._stopEventList.forEach(function(b){b.call(a)})},_fireLoadEvent:function(){var a=this;a._loadEventList.forEach(function(b){b.call(a)})},addPlayEvent:function(a){"[object Function]"==={}.toString.call(a)&&this._playEventList.push(a)},addStopEvent:function(a){"[object Function]"==={}.toString.call(a)&&this._stopEventList.push(a)},addLoadEvent:function(a){"[object Function]"==={}.toString.call(a)&&(this._loadEventList.push(a),this.isReady&&a.call(this))},play:function(){this.audio.play()},pause:function(){this.audio.pause()},stop:function(){this.audio.pause();try{this.audio.previousTime=0,this.audio.currentTime=0}catch(a){}},setPlayState:function(){this.isPlay||(this.isPlay=!0,this.icon.className="icon-music icon-music-animation",this._firePlayEvent())},setStopState:function(){this.isPlay&&(this.isPlay=!1,this.icon.className="icon-music",this._fireStopEvent())},continuePlay:function(){if(this.currentTime)try{this.audio.previousTime=this.currentTime,this.audio.currentTime=this.currentTime}catch(a){}},volume:function(){if(arguments.length){var a=Number(arguments[0]);!isNaN(a)&&a>=0&&(this.audio.volume=a)}return this.audio.volume},init:function(){var c=this;c.audio.addEventListener("play",function(a){c.setPlayState()},!1),c.audio.addEventListener("ended",function(a){c.setStopState()},!1),c.audio.addEventListener("pause",function(a){c.setStopState()},!1),c.audio.addEventListener("canplay",function(a){c.isReady||(c.isReady=!0,c.continuePlay(),c._fireLoadEvent())},!1),c.play_state&&"play"!==c.play_state||!c.autoPlay||(c.play(),b&&a(document,"touchstart",function(){c.play()})),c.icon.addEventListener("touchend",function(a){a.stopPropagation(),a.preventDefault(),sessionStorage[c.stateStamp]=c.isPlay?"stop":"play",c.isPlay?c.stop():c.play()},!1),window.addEventListener("beforeunload",function(){try{sessionStorage[c.timeStamp]=c.audio.previousTime||c.audio.currentTime}catch(a){}c.audio.pause()})}},d});