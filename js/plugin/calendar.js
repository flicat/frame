define(function(require,exports){var a=(require("event"),function(a){if(this.option={target:null,event:"focus","default":new Date,min:"",max:"",format:"Y-M-D"},"[object Object]"==={}.toString.call(a))for(var b in a)a.hasOwnProperty(b)&&a[b]&&(this.option[b]=a[b]);var c=this.getDateFromString(this.option["default"]),d=this.getDateFromString(this.option.max),e=this.getDateFromString(this.option.min);this.currentYear=Number(c.getFullYear()),this.currentMonth=Number(c.getMonth()),this.currentDate=Number(c.getDate()),this.maxYear=d?d.getFullYear():Number(this.currentYear)+100,this.maxMonth=d?d.getMonth():11,this.maxDate=d?d.getDate():31,this.minYear=e?e.getFullYear():Number(this.currentYear)-100,this.minMonth=e?e.getMonth():0,this.minDate=e?e.getDate():1,this.init()});return a.prototype={constructor:a,weekLang:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],weekMin:["周日","周一","周二","周三","周四","周五","周六"],getDateFromString:function(a){var b=null;if(!a||"[object String]"!=={}.toString.call(a)&&"[object Number]"!=={}.toString.call(a))a&&"[object Date]"==={}.toString.call(a)&&(b=a);else{var c=a.toString().match(/\d{4}\W\d{1,2}\W\d{1,2}/g)||"";if(c.length){var d=c[0].match(/\d{1,}/g);Number(d[0])>0&&Number(d[1])>0&&Number(d[2])>0&&(b=new Date(Number(d[0]),Number(d[1]-1),Number(d[2])))}else b=new Date,b.setTime(1e3*Number(a))}return b},getDateString:function(a,b,c){var d=this,e=d.getDateFromString(a);if(2==arguments.length&&("[object String]"!=={}.toString.call(b)?c=b:null),b="[object String]"==={}.toString.call(b)?b:"Y-M-D w",e){if(c)return Math.floor(e.getTime()/1e3);var f=String(e.getFullYear()),g=Number(e.getMonth())+1,a=Number(e.getDate()),h=d.weekLang[e.getDay()],i=d.weekMin[e.getDay()],j=e.getHours(),k=e.getMinutes(),l=e.getSeconds();return b.replace(/y+/g,f.substr(2,2)).replace(/m+/g,g).replace(/d+/g,a).replace(/w+/g,i).replace(/h+/gi,j).replace(/i+/gi,k).replace(/s+/gi,l).replace(/Y+/g,f).replace(/M+/g,10>g?"0"+g:g).replace(/D+/g,10>a?"0"+a:a).replace(/W+/g,h).replace(/H+/gi,10>j?"0"+j:j).replace(/I+/gi,10>k?"0"+k:k).replace(/S+/gi,10>l?"0"+l:l)}return""},getMonthDays:function(a,b){a=Number(a),b=Number(b);var c=function(a){return a%4!==0?!1:a%100!==0||a%400===0};return c(a)&&2===b?29:c(a)||2!==b?4===b||6===b||9===b||11===b?30:31:28},plusDate:function(a,b,c){var d=this,e=new Date;return e.setDate(e.getDate()+a),d.getDateString(e,b,c)},getDaysNum:function(a,b){var c=this,d=c.getDateFromString(a),e=c.getDateFromString(b);return d&&e?(d.setHours(0,0,0,0),e.setHours(0,0,0,0),parseInt((e.getTime()-d.getTime())/864e5)):0},selectYear:function(){var a=this,b=Math.round(a.wrapYear.scrollTop/a.pxHeight);a.wrapYear.scrollTop=b*a.pxHeight,a.currentYearNode&&a.currentYearNode.classList.remove("active"),a.currentYearNode=a.wrapYear.children[b+2],a.currentYearNode.classList.add("active"),a.currentYear=a.currentYearNode.getAttribute("data-year"),a.renderMonth(),a.scrollMonth(),a.renderDate(),a.scrollDate()},selectMonth:function(){var a=this,b=Math.round(a.wrapMonth.scrollTop/a.pxHeight);a.wrapMonth.scrollTop=b*a.pxHeight,a.currentMonthNode&&a.currentMonthNode.classList.remove("active"),a.currentMonthNode=a.wrapMonth.children[b+2],a.currentMonthNode.classList.add("active"),a.currentMonth=a.currentMonthNode.getAttribute("data-month"),a.renderDate(),a.scrollDate()},selectDate:function(){var a=this,b=Math.round(a.wrapDate.scrollTop/a.pxHeight);a.wrapDate.scrollTop=b*a.pxHeight,a.currentDateNode&&a.currentDateNode.classList.remove("active"),a.currentDateNode=a.wrapDate.children[b+2],a.currentDateNode.classList.add("active"),a.currentDate=a.currentDateNode.getAttribute("data-date")},renderYear:function(){for(var a="<span></span><span></span>",b=this.minYear;b<=this.maxYear;b++)a+='<span data-year="'+b+'">'+b+"</span>";a+="<span></span><span></span>",this.wrapYear.innerHTML=a},renderMonth:function(){var a=this,b="<span></span><span></span>",c=0,d=11;a.minYear==a.currentYear&&(c=a.minMonth),a.maxYear==a.currentYear&&(d=a.maxMonth);for(var e=c;d>=e;e++)b+='<span data-month="'+e+'">'+(e+1)+"</span>";b+="<span></span><span></span>",this.wrapMonth.innerHTML=b},renderDate:function(){var a=this,b="<span></span><span></span>",c=1,d=a.getMonthDays(a.currentYear,Number(a.currentMonth)+1);a.minYear==a.currentYear&&a.minMonth==a.currentMonth&&(c=a.minDate),a.maxYear==a.currentYear&&a.maxMonth==a.currentMonth&&(d=a.maxDate);for(var e=c;d>=e;e++)b+='<span data-date="'+e+'">'+e+"</span>";b+="<span></span><span></span>",this.wrapDate.innerHTML=b},scrollYear:function(){var a=this;a.wrapYear.scrollTop=(a.currentYear-a.minYear)*a.pxHeight,a.selectYear()},scrollMonth:function(){var a=this,b=a.minYear==a.currentYear?a.minMonth:0;a.currentMonth<b&&(a.currentMonth=b),a.maxYear==a.currentYear&&a.currentMonth>a.maxMonth&&(a.currentMonth=a.maxMonth),a.wrapMonth.scrollTop=(a.currentMonth-b)*a.pxHeight,a.selectMonth()},scrollDate:function(){var a=this,b=a.minYear==a.currentYear&&a.minMonth==a.currentMonth?a.minDate:1;a.currentDate<b&&(a.currentDate=b),a.maxYear==a.currentYear&&a.maxMonth==a.currentMonth&&a.maxDate<a.currentDate&&(a.currentDate=a.maxDate),a.wrapDate.scrollTop=(a.currentDate-b)*a.pxHeight,a.selectDate()},show:function(){var a=this;a.calNode.style.display="block",a.pxHeight=a.wrapYear.scrollHeight/a.wrapYear.children.length,a.scrollYear(),a.scrollMonth(),a.scrollDate()},hide:function(){this.calNode.style.display="none"},init:function(){var a=this,b=a.option;if(b.target){a.calNode=document.createElement("div"),a.calNode.className="calendar",a.calNode.innerHTML='<div class="cal-content"><div class="cal-bar"><a href="javascript:;" class="btn-cancel">取消</a><a href="javascript:;" class="btn-confirm">确定</a></div><div class="cal-row"><div class="cal-current"><span>年</span><span>月</span><span>日</span></div><div class="cal-cell year"></div><div class="cal-cell month"></div><div class="cal-cell date"></div></div></div>',document.body.appendChild(a.calNode),a.btnCancel=a.calNode.querySelector(".btn-cancel"),a.btnConfirm=a.calNode.querySelector(".btn-confirm"),a.wrapYear=a.calNode.querySelector(".year"),a.wrapMonth=a.calNode.querySelector(".month"),a.wrapDate=a.calNode.querySelector(".date");var c=null,d=null,e=null;a.wrapYear.addEventListener("scroll",function(){clearTimeout(c),c=setTimeout(function(){a.selectYear()},100)}),a.wrapMonth.addEventListener("scroll",function(){clearTimeout(d),d=setTimeout(function(){a.selectMonth()},100)}),a.wrapDate.addEventListener("scroll",function(){clearTimeout(e),e=setTimeout(function(){a.selectDate()},100)}),b.target.addEventListener(b.event,function(b){b.preventDefault(),b.stopPropagation();var c=a.getDateFromString(this.value);c&&(a.currentYear=Number(c.getFullYear()),a.currentMonth=Number(c.getMonth()),a.currentDate=Number(c.getDate())),a.show()}),a.btnConfirm.addEventListener("click",function(){b.target.value=a.getDateString(new Date(a.currentYear,a.currentMonth,a.currentDate),b.format),b.target.trigger("input"),b.target.trigger("change"),a.hide()}),a.btnCancel.addEventListener("click",function(){a.hide()}),a.renderYear(),a.renderMonth(),a.renderDate()}}},a});